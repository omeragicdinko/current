<style>
  .error{
    color:red;
  }
</style>
<h1>FORMS</h1>

<!-- Button trigger modal -->

<table class="table">
   <thead>
     <tr>
       <th scope="col">Name</th>
       <th scope="col">Surname</th>
       <th scope="col">Email</th>
       <th scope="col">Phone Number</th>
       <th scope="col">Delete</th>
     </tr>
   </thead>
   <tbody id="table_content">
   </tbody>
</table>
<div class="modal" id="userLoginModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form id="user_login_form">
      <div class="modal-header">
        <h4 class="modal-title" id="userLoginModalLabel">User Login</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
            <div>
              <label for="user_email_login">Email:</label>
              <input type="email" id="user_email_login" name="user_email_login" class="form-control"></input>
            </div>
            <div>
              <label for="psword_login">Password:</label>
              <input type="password" id="psword_login" name="psword_login" class="form-control"></input>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" >Log in</button>
      </div>
      </form>
    </div>
  </div>
</div>








<script>
get_users();
    function get_users(){
      $.get( "rest/users", function( data ) {
        var html = '';
        for(var i = 0; i < data.length; i++){
          html += '<tr> <td>' + data[i].name + '</td>';
          html += '<td>' + data[i].surname + '</td>';
          html += '<td>' + data[i].email + '</td>';
          html += '<td>' + data[i].phone_number + '</td>';
          html += '<td><button type="button" class="btn btn-danger" onclick="delete_user('+data[i].id+');">Delete</button></td> </tr>';
        }
        $("#table_content").html(html);
      });
    }
    function delete_user(id){
      $.ajax({
        url: 'rest/user/'+id,
        method: 'DELETE',
        success: function(result) {
            toastr.success('Deleted');
            get_users();
        },
        error: function(){
          toastr.success('Not deleted');
        }
    });

}




  function open_modal_user_login(){
    $("#userLoginModal").modal("toggle");
  }

  $("#user_registration_form").validate({
    rules: {
      fname: {
        required: true,
        minlength: 3
      },
      lname: {
        required: true,
        minlength: 3
      },
      user_email: {
        required: true,
        email: true
      },
      user_address: {
        required: true
      },
      user_phone_number: {
        required: true
      },
      user_city: {
        required: true
      },
      user_country: {
        required: true
      },
      psword: {
        required: true,
        minlength: 8
      },
      psword_confirm: {
        required: true,
        minlength: 8,
        equalTo: "#psword"
      }
    },
    messages: {
      fname: {
        required: "Please enter your name",
        ninlength: "Please enter at least 3 characters"
      },
      lname: {
        required: "Please enter your surname",
        ninlength: "Please enter at least 3 characters"
      },
      user_email: {
        required: "Please enter your email address"
      },
      user_address: {
        required: "Please enter your address"
      },
      user_phone_number: {
        required: "Please enter your phone number"
      },
      user_city: {
        required: "Please enter name of your city"
      },
      user_country: {
        required: "Please enter name of your country"
      },
      psword: {
        required: "Please enter your new password",
        minlength: "Password must contain at least 8 characters"
      },
      psword_confirm: {
        required: "Please enter your new password again",
        minlength: "Password must contain at least 8 characters",
        isEqual: "Passwords do not match"
      }
    },
    submitHandler: function(form, validator) {
     $.post('rest/users', $("#user_registration_form").serialize()).done(function(){ //send serialized data                    from test form to the endpoint rest/students
       toastr.success('User added'); //display success message
       $('#userRegistrationModal').modal('toggle'); //close modal
       get_users();   //read students
     }).fail(function(){
        toastr.error('User not added');
     });
  },

  });

  $("#user_login_form").validate({
    rules: {
      user_email_login: {
        required: true,
        email: true
      },
      psword_login: {
        required: true,
      }
    },
    messages: {
      user_email_login: {
        required: "Please enter your email address"
      },
      psword_login: {
        required: "Please enter your password",
      }
    },
    submitHandler: function(form) {
      $("#userLoginModal").modal("toggle");
    }
  });
</script>
